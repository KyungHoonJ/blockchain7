# 암호화

- 블록체인에서 누가 했는지, 즉 신원을 확인하기 위해서 양방향 암호화를 사용한다.
- 지금까지 다뤄왔던 Hash(SHA256)는 단방향 암호화로 복호화가 불가능하다.
- 양방향 암호화는 암호화, 복호화 모두 가능하다.

## 비대칭 암호화

- 블록체인에서 사용하는 양방향 암호화는 개인키와 공개키로 이루어진 비대칭 암호화이다.

- 대칭 VS 비대칭

  - 대칭 암호화

  ```mermaid
  flowchart LR
  A[입력된 값]
  B[168498AB684FE3548CD]
  C[입력된 값]
  A-->|암호화키\n암호화|B-->|암호화키\n복호화|C
  ```

        - 암호화 할 때와 복호화 할 때 같은 키를 사용한다.

  - 비대칭 암호화

    ```mermaid
    flowchart LR
    A[입력된 값]
    B[168498AB684FE3548CD]
    C[입력된 값]
    A-->|개인키\n암호화|B-->|공개키\n복호화|C
    ```

    - 개인키는 안전하게 보관할 수 있으며 암호문과 공개키를 상대에게 공유함으로써 데이터를 확인할 수 있다.
    - 공개키로 복호화 할 수 있는 암호문은 연결된 개인키로 생성한 암호문 뿐이어야한다.

  - 블록체인에서 어떻게 사용하는가?
    ```mermaid
    flowchart
    A[입력된 값]
    B[168498AB684FE3548CD]
    C[Signature/서명\n다른 사람에게 공개키와 함께 전달]
    D[168498AB684FE3548CD]
    E[입력된 값]
    F[168498AB684FE3548CD]
    A-->|SHA256|B-->|개인키로 암호화|C-->|공개키로 복호화|D---|비교|F
    E-->|SHA256|F
    ```

# 타원곡선

- 암호화 알고리즘 중 하나(ECC, elliptic curve cryptography)
- 개인키와 공개키를 만들기 위해서 사용한다.
- RSA를 안쓰고 이걸 쓰는 이유

  - 동일한 안정성을 가지면서도 RSA보다 짧은 키를 사용한다.
  - 휴대폰 등 계산을 많이 할 수 없는(성능이 떨어지는) 환경에서 사용된다.

- 타원곡선에서 사용하는 함수

  - y^2 = x^3 + ax + b
  - 비트코인과 이더리움에서 사용하는 함수는 y^2 = x^3 + 7 이다.

- 타원곡선에서의 덧셈 규칙

  - P + Q + R = 0

- 개인키(k)

  - 임의의 점 P를 더하여 새로운 점을 찾은 횟수

- 공개키(kP)

  - P를 k번 더해서 찾은 점

- 기준점(G)

  - 이더리움과 비트코인에서 공개키를 구하기 위해 사용하는 점
    - 02 79BE667E F9DCBBAC 55A06295 CE870B07 029BFCDB 2DCE28D9 59F2815B 16F81798 << 실재 사용하고 있는 것

- 개인키(k)가 너무 크기 때문에 계산에 있어서 알고리즘을 사용한다.
  - Double-and-Add 알고리즘을 사용한다.
    - 타원 곡선 알고리즘을 계산할 때 k가 너무 크기 때문에 빠르게 돌리기 위해서 사용한다.
  - 횟수를 2진수로 표기 후 0 또는 1을 더하도록 처리한다.
  - 35 횟수를 예시로 아래의 순서를 진행하겠다.
    1. 35 = 2진수로 100011
    2. 왼쪽의 첫 자리의 1부터 시작하여 G를 더한다. => 0 \* 2 + G = G
    3. 두번째 자리는 0이기 때문에 G \* 2 = 2G
    4. 세번째 자리는 0이기 때문에 2G \* 2 = 4G
    5. 네번째 자리는 0이기 때문에 4G \* 2 = 8G
    6. 다섯번째 자리는 1이기 때문에 8G \* 2 + G = 17G
    7. 여섯번째 자리는 1이기 때문에 17G \* 2 + G = 35G
  - 공식으로 보자면 "이전 값 \* 2 + 2진수(0, 1) \* G"
  - 개인키가 16진수로 된 64자리의 수 => 16^64 => 이만한 횟수가 256번으로 끝난다. 32 bytes => 256 bits(10100100111010100... << 256 갯수)

# 지갑

- 지갑에서 계정을 생성할 경우 개인키와 공개키를 생성한다.
- 공개키를 사용해서 지갑 주소를 만든다.
  - 비트코인
    - 암호화를 여러번 거친 후에 사용한다.
  - 이더리움
    - 뒤에서부터 40자만 사용한다.
